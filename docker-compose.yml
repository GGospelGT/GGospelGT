version: '3.9'
services:
  backend:
    build:
      context: .
      dockerfile: GGospelGT/backend/Dockerfile
    environment:
      - PORT=8000
      - ALLOWED_ORIGINS=${ALLOWED_ORIGINS:-*}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost}
      - MESSAGE_ATTACHMENT_MAX_BYTES=${MESSAGE_ATTACHMENT_MAX_BYTES:-10485760}
      - CERT_IMAGE_MAX_BYTES=${CERT_IMAGE_MAX_BYTES:-5242880}
      - MONGO_URL=${MONGO_URL}
      - DB_NAME=${DB_NAME:-servicehub}
      - SENDGRID_API_KEY=${SENDGRID_API_KEY}
      - SENDER_EMAIL=${SENDER_EMAIL}
      - TERMII_API_KEY=${TERMII_API_KEY}
      - TERMII_SENDER_ID=${TERMII_SENDER_ID}
      - SECRET_KEY=${SECRET_KEY}
      - UPLOADS_DIR=/app/backend/uploads
    volumes:
      - ./GGospelGT/backend/uploads:/app/backend/uploads
    expose:
      - "8000"
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: GGospelGT/frontend/Dockerfile
    depends_on:
      - backend
    ports:
      - "80:80"
    restart: unless-stopped